<!DOCTYPE html>
<html>
<head>
    <title>Voies Ferrées en Normandie</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Ajout de Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Ajout de Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <!-- Ajout de jQuery pour faciliter les requêtes AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/osmtogeojson@3.0.0-beta.5/osmtogeojson.min.js"></script>
    
    <style>
        #map {
            height: 400px;
        }
        #debug {
            height: 150px;
            overflow: auto;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div id="debug"></div>

<script>
    // Fonction pour afficher les messages dans la div de débogage
    function debugLog(message) {
        var debugDiv = document.getElementById("debug");
        debugDiv.innerHTML += message + "<br>";
    }

    // Initialisation de la carte
    var map = L.map('map').setView([49.182863, 0.370679], 8);

    // Ajout du fond de carte OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Fonction pour charger les données des voies ferrées via Overpass API
    function loadRailways() {
        var overpassApiUrl = "https://overpass-api.de/api/interpreter";
        var overpassQuery = `[out:json][timeout:25];
                     area["ISO3166-2"="FR-S"][admin_level=4];
                     (
                       way["railway"](area);
                       relation["railway"](area);
                     );
                     (._;>;);
                     out body;`;


    $.ajax({
        url: overpassApiUrl,
        method: 'GET',
        data: {data: overpassQuery},
        dataType: 'json',
        success: function(data) {
            try {
                var osmData = osmtogeojson(data);
                L.geoJSON(osmData, {
                    style: function(feature) {
                        return {color: "#ff0000", weight: 3};
                    }
                }).addTo(map);
                debugLog("Voies ferrées affichées sur la carte.");
            } catch (error) {
                debugLog("Erreur lors de la conversion des données : " + error);
            }
        },
        error: function(xhr, status, error) {
            debugLog("Erreur lors de la récupération des données: " + status + " " + error);
        }
    });
}

// Appel de la fonction pour charger les voies ferrées dès que la page est chargée
$(document).ready(function() {
    loadRailways();
});
</script>
</body>
</html>
