<!DOCTYPE html>
<html>
<head>
    <title>Voies Ferrées en Normandie</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Ajout de Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- Ajout de Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <!-- Ajout de jQuery pour faciliter les requêtes AJAX -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/osmtogeojson@3.0.0-beta.5/osmtogeojson.min.js"></script>
    
    <style>
        #map {
            height: 400px;
        }
        #debug {
            height: 150px;
            overflow: auto;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div id="map"></div>
<div id="debug"></div>

<script>
    // Fonction pour afficher les messages dans la div de débogage
    function debugLog(message) {
        var debugDiv = document.getElementById("debug");
        debugDiv.innerHTML += message + "<br>";
    }

    // Initialisation de la carte
    var map = L.map('map').setView([49.182863, 0.370679], 8);

    // Ajout du fond de carte OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Fonction pour charger les données des voies ferrées via Overpass API
    function loadRailways() {
        var overpassApiUrl = "https://overpass-api.de/api/interpreter";
        var overpassQuery = `[out:json][timeout:25];
                                  area[name="Hauts-de-France"]->.searchArea;
                                  (
                                    way["railway"](area.searchArea);
                                  );
                                  out body; 
                                  >; 
                                  out skel qt;`;


   $.ajax({
        url: overpassApiUrl,
        method: 'GET',
        data: {data: overpassQuery},
        dataType: 'json',
        success: function(data) {
            var osmData = osmtogeojson(data);
            L.geoJSON(osmData, {
                style: function(feature) {
                    return {color: "#ff0000", weight: 3};
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.tags) {
                        var name = feature.properties.tags.name || "Inconnu";
                        var ref = feature.properties.tags.ref || "Pas de numéro";
                        layer.bindPopup("Nom: " + name + "<br>Numéro: " + ref);
                    }
                }
            }).addTo(map);
        },
        error: function(xhr, status, error) {
            console.error("Erreur lors de la récupération des données: " + error);
        }
    });
}

// Appel de la fonction pour charger les voies ferrées dès que la page est chargée
$(document).ready(function() {
    loadRailways();
});
</script>
</body>
</html>
